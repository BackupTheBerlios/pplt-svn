<?xml version="1.0"?>
<!-- FIXME use some of the elements defined in Module-trex.xml to extend this
    gammar. //-->
<grammar>
    <start>
        <element name="Assembly">
            <attribute name="version"><string>1.0</string></attribute>
            
            <optional><element name="Author"><anyString/></element></optional>

            <element name="Version"><anyString/></element>
            
            <zeroOrMore>
                <ref name="description"/>
            </zeroOrMore>


            <element name="Requires">
                <zeroOrMore>
                    <element name="Parameter">
                        <attribute name="name"/>
                        <optional><attribute name="default"/></optional> 
                        <zeroOrMore><ref name="description"/></zeroOrMore>
                    </element>
                </zeroOrMore>
                <zeroOrMore>
                    <element name="Module"><anyString/></element>
                </zeroOrMore>
            </element>


            <element name="Setup">
                <oneOrMore>
                    <element name="Module">
                        <attribute name="name"/>
                        <attribute name="alias"/>
                        <zeroOrMore>
                            <element name="Parameter">
                                <attribute name="name"/>
                                <choice>
                                    <anyString>
                                    <element name="ValueOf"></anyString></element>
                                </choice>
                            </element>
                        </zeroOrMore>
                    </element>
                </oneOrMore>
                <zeroOrMore>
                    <element name="Link">
                        <attribute name="from"/>
                        <attribute name="to"/>
                    </element>
                </zeroOrMore>
            </element>


            <element name="Provides">
                <zeroOrMore>
                    <element name="Input">
                        <attribute name="name"/>
                        <attribute name="type"/>
                        <attribute name="link"/>
                        <zeroOrMore> <ref name="description"/> </zeroOrMore>
                    </element>
                </zeroOrMore>

                <zeroOrMore>
                    <element name="Output"> 
                        <attribute name="name"/>
                        <attribute name="type"/>
                        <attribute name="link"/>
                        <zeroOrMore> <ref name="description"/> </zeroOrMore>
                    </element>
                </zeroOrMore>
            </element>


            <optional>
                <element name="Layout">
                    <oneOrMore> <ref name="rule"/> </oneOrMore>                
                </element>
            </optional> 

        </element>
    </start>


    <define name="description">
        <element name="Description">
            <attribute name="lang"/>
        </element>
    </define>


    <define name="rule">
        <!-- A Rule can be used to specify how an in- or output is displayed 
            on the GUI. A rule take a "name" or "pattern" attribute to specify
            which in- or outputs matching this rule. 
            Any rule can contain other rules to specialize the rule for a 
            defined subset of in/outputs.
            //-->
        <element name="Rule">
            <choice>
                <attribute name="name"/>
                <attribute name="pattern"/>
            </choice>
            
            <!-- This element specifies where to put the in/output. //-->
            <element name="Position">
                <choice>
                    <string>left</string>
                    <string>right</string>
                </choice>
            </element>
            
            <!-- This optional element specifies the weight of the in/output.
                The weight will be used to sort the pins on one side.//-->
            <element name="Weight"></anyString></element>
            
            <!-- Subrules //-->
            <zeroOrMore> <ref name="rule"/> </zeroOrMore>              
        </element>
    </define>
 </grammar>



<element name="Assembly">
    
    <optional><element name="Author"><anyString/></element></optional>

    <element name="Version"><anyString/></element>

    <element name="Requires">
        <optional>                
            <element name="Parameter">
                <attribute name="name"/>
                <optional><attribute name="default"/></optional> 
            </element>
        </optional>
            
        <oneOrMore>
            <element name="Module"><anyString/></element>
        </oneOrMore>
    </element>



    <element name="Provides">
        <element name="Input">
            <attribute name="name"/>
            <attribute name="type"/>
            <element name="Redirect">
                <attribute name="to"/>  <!-- "alias:name" //-->
            </element>                
        </element>
        
        <element name="Output"> 
            <attribute name="name"/>
            <attribute name="type"/>
            <element name="Redirect">
                <attribute name="to"/>
            </element>                
         </element>
    </element>


    <element name="Setup">
        <oneOrMore>
            <element name="Module">
                <attribute name="name"/>
                <attribute name="alias"/>
                <optional>
                    <element name="Parameter">
                        <attribute name="name">
                        <choice>
                            <anyString/>
                            <element name="ValueOf"><anyString></element>
                        </choice>
                    </element>                    
                </optional>
            </element>
        </oneOrMore>

        <optional>
            <element name="Link">
                <attribute name="from"/>
                <attribute name="to"/>
            </element>
        </optional>            
    </element>

</eement>
